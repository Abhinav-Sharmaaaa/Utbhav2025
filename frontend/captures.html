<!DOCTYPE html>
<html>
<head>
    <title>Danger Captures - TOURISTA</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="captures-page"> <header>
        <div class="nav-left">
            <i class="fas fa-shield-alt shield"></i>
            <div class="logo">TOURISTA</div>
        </div>
        <nav>
            <a href="/">Home</a>
            <a href="/scan">Scan Monitor</a>
            <a href="/captures">Captures</a>
            <a href="/tips">Safety Tips</a>
            <a href="/tech">Technology</a>
            <a href="/team">Team</a>
        </nav>
    </header>

    <div class="captures-header">
        <div class="stat">
            <div class="stat-value" id="totalCaptures">0</div>
            <div class="stat-label">Total Captures</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="lastCapture">--</div>
            <div class="stat-label">Last Capture</div>
        </div>
    </div>

    <div class="captures-container">
        <div class="captures-toolbar">
            <button class="captures-btn clear" onclick="clearCaptures()">üóëÔ∏è Clear All Captures</button>
        </div>
        
        <div id="capturesContainer">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading captures...</p>
            </div>
        </div>
    </div>

    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
        // --- ALL INLINE JAVASCRIPT REMAINS UNCHANGED ---
        function loadCaptures() {
            fetch('/api/captures')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('capturesContainer');
                    const captures = data.captures || [];
                    
                    document.getElementById('totalCaptures').textContent = captures.length;
                    if (captures.length > 0) {
                        document.getElementById('lastCapture').textContent = 
                            new Date(captures[0].timestamp).toLocaleTimeString();
                    } else {
                        document.getElementById('lastCapture').textContent = "--";
                    }
                    
                    if (captures.length === 0) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-check-circle" style="color: #00ff00;"></i>
                                <h2>No Danger Captures</h2>
                                <p>All clear! No threats have been detected yet.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let html = '<div class="captures-grid">';
                    captures.forEach((capture, index) => {
                        html += `
                            <div class="capture-card">
                                <img src="data:image/jpeg;base64,${capture.image}" 
                                     class="capture-image" 
                                     onclick="openModal('${capture.image}')"
                                     alt="Danger capture">
                                <div class="capture-info">
                                    <div class="capture-time">
                                        <i class="fas fa-clock"></i> ${new Date(capture.timestamp).toLocaleString()}
                                    </div>
                                    <div class="capture-description">
                                        <i class="fas fa-exclamation-circle"></i> ${capture.description}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error loading captures:', error);
                    const container = document.getElementById('capturesContainer');
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-triangle" style="color: #ff0000;"></i>
                            <h2>Error Loading Captures</h2>
                            <p>Could not connect to the server.</p>
                        </div>
                    `;
                });
        }
        
        function clearCaptures() {
            if (confirm('Are you sure you want to clear all danger captures? This cannot be undone.')) {
                fetch('/api/clear_captures', { method: 'POST' })
                    .then(() => {
                        loadCaptures();
                    })
                    .catch(error => {
                        console.error('Error clearing captures:', error);
                        alert('Failed to clear captures');
                    });
            }
        }
        
        function openModal(imageBase64) {
            document.getElementById('imageModal').style.display = 'block';
            document.getElementById('modalImage').src = 'data:image/jpeg;base64,' + imageBase64;
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        document.addEventListener('DOMContentLoaded', loadCaptures);
        setInterval(loadCaptures, 5000); // Keep auto-refresh
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>

</body>
</html>